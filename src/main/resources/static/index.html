<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Java Live Compiler</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    #editor {
      height: 400px;
      border: 1px solid #333;
    }
    #output {
      white-space: pre-wrap;
      font-family: 'Fira Code', monospace;
      min-height: 400px; /* same height as editor */
      overflow-x: auto;
    }
  </style>
</head>
<body class="p-6 min-h-screen transition-colors duration-500">

  <div class="max-w-7xl mx-auto space-y-4">
    <div class="flex justify-between items-center">
      <h1 class="text-3xl font-bold text-blue-400">🧠 Java Live Compiler</h1>
      <button id="toggleThemeBtn"
        class="py-2 px-4 rounded transition"
        aria-label="Toggle Light/Dark Mode"
      >
        <!-- text set dynamically -->
      </button>
    </div>

    <input type="text" id="filename" value="Main.java"
      class="px-4 py-2 rounded border w-64 transition-colors duration-500" />

    <!-- FLEX CONTAINER: column on small, row on md+ -->
    <div class="flex flex-col md:flex-row gap-6">
      <div class="flex-1 flex flex-col">
        <label for="editor" class="mb-2 text-sm font-medium transition-colors duration-500">Java Code</label>
        <div id="editor"></div>
      </div>

      <div class="flex-1 flex flex-col">
        <label for="output" class="mb-2 text-sm font-medium transition-colors duration-500">Output</label>
        <pre id="output" class="p-4 rounded min-h-[400px] transition-colors duration-500">// Output appears here</pre>
      </div>
    </div>

    <div class="flex gap-4">
      <button onclick="compileCode()"
        class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded transition-colors duration-300">
        ▶ Run Code
      </button>
      <button onclick="downloadCode()"
        class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded transition-colors duration-300">
        💾 Download Code
      </button>
    </div>
  </div>

  <!-- Load Monaco Editor -->
  <script src="https://unpkg.com/monaco-editor@0.45.0/min/vs/loader.js"></script>
  <script>
    let editor;
    let isDark = true; // current mode

    function loadTheme() {
      const saved = localStorage.getItem('javaCompilerTheme');
      if (saved === 'light') return false;
      return true;
    }

    function applyTheme(dark) {
      const body = document.body;
      const toggleBtn = document.getElementById("toggleThemeBtn");
      const filename = document.getElementById("filename");
      const output = document.getElementById("output");

      if (dark) {
        body.classList.remove("bg-white", "text-gray-900");
        body.classList.add("bg-gray-900", "text-gray-100");
        toggleBtn.textContent = "🌞 Light Mode";
        toggleBtn.classList.remove("bg-gray-200", "text-gray-900");
        toggleBtn.classList.add("bg-gray-700", "text-gray-100");
        filename.classList.remove("bg-white", "text-gray-900", "border-gray-300");
        filename.classList.add("bg-gray-800", "text-gray-100", "border-gray-700");
        output.classList.remove("bg-white", "text-black", "border-gray-300");
        output.classList.add("bg-black", "text-green-300", "border", "border-gray-700");
        editor.updateOptions({ theme: "vs-dark" });
      } else {
        body.classList.remove("bg-gray-900", "text-gray-100");
        body.classList.add("bg-white", "text-gray-900");
        toggleBtn.textContent = "🌙 Dark Mode";
        toggleBtn.classList.remove("bg-gray-700", "text-gray-100");
        toggleBtn.classList.add("bg-gray-200", "text-gray-900");
        filename.classList.remove("bg-gray-800", "text-gray-100", "border-gray-700");
        filename.classList.add("bg-white", "text-gray-900", "border-gray-300");
        output.classList.remove("bg-black", "text-green-300", "border-gray-700");
        output.classList.add("bg-white", "text-black", "border", "border-gray-300");
        editor.updateOptions({ theme: "vs-light" });
      }
      isDark = dark;
      localStorage.setItem('javaCompilerTheme', dark ? 'dark' : 'light');
    }

    require.config({ paths: { vs: 'https://unpkg.com/monaco-editor@0.45.0/min/vs' } });
    require(["vs/editor/editor.main"], function () {
      editor = monaco.editor.create(document.getElementById('editor'), {
        value: `public class Main {
    public static void main(String[] args) {
        System.out.println("Hello, Java!");
    }
}`,
        language: 'java',
        theme: 'vs-dark', // will be overridden
        automaticLayout: true
      });

      applyTheme(loadTheme());
    });

    async function compileCode() {
      const code = editor.getValue();
      const output = document.getElementById("output");
      output.textContent = "⏳ Compiling...";

      try {
        const response = await fetch("/api/compiler/run", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ code }),
        });

        const result = await response.text();
        output.textContent = result;
      } catch (error) {
        output.textContent = "❌ Error: " + error.message;
      }
    }

    function downloadCode() {
      const code = editor.getValue();
      const filename = document.getElementById("filename").value.trim() || "Main.java";
      const blob = new Blob([code], { type: "text/java" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    document.getElementById("toggleThemeBtn").addEventListener("click", () => {
      applyTheme(!isDark);
    });
  </script>
</body>
</html>
